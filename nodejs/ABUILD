# ABUILD generated by mkpkg_generator.sh

pkgname=nodejs
pkgver=0.10.26
pkgbuild=1
arch=("auto")

shortdesc=("Evented I/O for V8 javascript")
tags=("net-libs server")
source=("http://nodejs.org/dist/v$pkgver/node-v$pkgver.tar.gz")
build_deps="openssl python zlib"

before_build() {
  go_src_dir
  # enable debug options i.e. --print-opt-code
  export GYP_DEFINES="v8_enable_disassembler=1 v8_object_print=1"
  # Set ${LIBDIRSUFFIX}
  sed -e "s|\(['/]lib\)/|\1${LIBDIRSUFFIX}/|g" -i tools/install.py
}

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr \
  --shared-zlib \
  --shared-openssl"
INSTALL_KEYS="DESTDIR=$pkgdir"

after_build() {
  go_src_dir
  # install docs as per user request
  install -d "$pkgdir"/usr/doc/${pkgname}-${pkgver}
  cp -r doc/api/{*.html,assets} "$pkgdir"/usr/doc/${pkgname}-${pkgver}
  install -D -m644 LICENSE "$pkgdir"/usr/share/licenses/nodejs/LICENSE
}