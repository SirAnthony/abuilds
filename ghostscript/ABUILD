# ABUILD generated by mkpkg_generator.sh

pkgname=ghostscript
pkgver=9.10
pkgbuild=1
arch=("auto")

shortdesc=("GPL Ghostscript")
longdesc=("An interpreter for the PostScript language")

tags=("app-text console")

source=("http://downloads.ghostscript.com/public/ghostscript-${pkgver}.tar.bz2")
build_deps="libXt cups fontconfig libjpeg libpng zlib jasper expat libtiff lcms dbus"

# Fails to build with multiple jobs
numjobs=1

before_build() {
	go_src_dir
	# force it to use system-libs
	rm -rf jpeg libpng zlib jasper expat tiff freetype lcms
}

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --mandir=/usr/man \
  --enable-dynamic \
  --with-ijs \
  --with-jbig2dec \
  --with-omni \
  --with-x \
  --with-drivers=ALL\
  --with-fontpath=/usr/share/fonts/Type1:/usr/share/fonts \
  --without-luratech \
  --with-install-cups \
  --enable-fontconfig \
  --enable-freetype \
  --without-luratech \
  --without-omni \
  --with-system-libtiff \
  --disable-compile-inits"
INSTALL_KEYS="DESTDIR=${pkgdir} \
  cups_serverroot=${pkgdir}/etc/cups \
  cups_serverbin=${pkgdir}/usr/lib${LIBDIRSUFFIX}/cups \
  install soinstall"

after_build() {
  go_src_dir
  # Build IJS
  cd ijs
  ./autogen.sh
  ./configure --prefix=/usr --libdir=/usr/lib${LIBDIRSUFFIX} --enable-shared --disable-static
  make -j${numjobs}
  make DESTDIR=${pkgdir} install
}

