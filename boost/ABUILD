# ABUILD generated by mkpkg_generator.sh

pkgname=boost
pkgver=1.55.0
_boostver=${pkgver//./_}
pkgbuild=4
arch=('auto')

shortdesc=('Boost C++ Libraries')
longdesc=('Boost provides free peer-reviewed portable C++ source libraries. The emphasis is on libraries that work well with the C++ Standard Library. One goal is to establish "existing practice" and provide reference implementations so that the Boost libraries are suitable for eventual standardization. Homepage: http://www.boost.org/')

tags=('libs dev-libs')

source=("http://downloads.sourceforge.net/sourceforge/${pkgname}/${pkgname}_${_boostver}.tar.bz2")
build_deps="icu4c python bzip2 zlib"

build() {
	go_src_dir
	burn_patches
	# This is the python we build against:
	PYTHON_VERSION=$(python -c 'import sys; print sys.version[:3]')
	PYTHON_FLAGS="-sPYTHON_ROOT=/usr -sPYTHON_VERSION=$PYTHON_VERSION"

	# First build bjam, the boost build system:
	cd tools/build/v2/engine
	CFLAGS="$SLKCFLAGS -fno-strict-aliasing" CC=gcc ./build.sh cc
	cd -

	BJAM=$(find tools/build/v2/engine -name bjam -a -type f)

	# Create build subdirectory
	mkdir obj

	# Change the build options from 'minimal' to what we want, since adding
	# "-sBUILD=<optimization>speed <inlining>full <threading>single/multi
	# <link>shared <runtime-link>shared" to $BJAM command no longer seems to work.
	FLAGS="<threading>multi <threading>single <optimization>speed <inlining>full"
	sed -i "s/    <threading>multi/    $FLAGS/" Jamroot
	# Disable static libraries ( the only software that *requires* the static libs,
	# is Microsoft's CW compiler (CW or Comega is an experimental language which
	# extends C# )
	sed -i "s/<link>shared <link>static/<link>shared/" Jamroot

	# Next, we build boost using bjam
	$BJAM release debug-symbols=off threading=single,multi \
        runtime-link=shared link=shared,static \
        cflags=-fno-strict-aliasing \
        toolset=gcc \
	--without-mpi \
	"-sNO_COMPRESSION=0" \
	"-sZLIB_INCLUDE=/usr/include" \
	"-sZLIB_LIBPATH=/usr/lib${LIBDIRSUFFIX}" \
	"-sBZIP2_INCLUDE=/usr/include" \
	"-sBZIP2_LIBPATH=/usr/lib${LIBDIRSUFFIX}" \
	"-sEXPAT_INCLUDE=/usr/include" \
	"-sEXPAT_LIBPATH=/usr/lib${LIBDIRSUFFIX}" \
	-sTOOLS=gcc \
	--layout=tagged \
	--prefix=${pkgdir}/usr \
	--libdir=${pkgdir}/usr/lib${LIBDIRSUFFIX} \
	$PYTHON_FLAGS \
	-j${numjobs} \
	install || exit 1

	mkdir -p $pkgdir/usr/doc/boost-$pkgver $pkgdir/usr/bin/
	# Do not copy 44MB of developer 'doc/html' into our package...
	cp -a LICENSE* index.html $pkgdir/usr/doc/boost-$pkgver
	find $pkgdir/usr/doc -type f -exec chmod 0644 {} \;
	cp $BJAM $pkgdir/usr/bin/
}

